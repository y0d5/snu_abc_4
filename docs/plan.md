# 강의 노트 자동 정리 프로그램 계획서

## 1. 프로젝트 개요

### 목표
강연 자료(PDF)와 STT 스크립트(TXT)를 결합하여, 슬라이드별 주요 내용이 정리된 강의 노트를 자동 생성한다.

### 최종 결과물 형태
- **형식**: 마크다운 문서 (PDF/HTML로 변환 가능)
- **구조**:
  - 각 슬라이드 이미지 또는 참조
  - 해당 슬라이드의 주요 강의 내용 요약
  - Q&A 섹션 (마지막)
  - Key Takeaways 섹션 (마지막)

---

## 2. 데이터 구조

### 폴더 구조
```
data:/
├── 01-류근관-BigData AI Economy-251226/
│   ├── *.pdf (강연 자료)
│   └── *.txt (STT 스크립트) - 없을 수 있음
├── 02-이재욱-AI 소개-260102/
│   └── ...
└── ...
```

### 폴더명 규칙
`{번호}-{강연자}-{주제}-{날짜(YYMMDD)}`

### 파일 형식
- **PDF**: 강연 슬라이드 자료 (여러 개일 수 있음)
- **TXT**: 클로바 노트 STT 스크립트
  - 형식: `{화자} {MM:SS}` + 내용
  - 파일이 분할될 수 있음 (예: `-1-`, `-2-`)

---

## 3. 처리 단계

### Step 1: 강의 일자 선택
```
[프로그램 시작]
    │
    ▼
┌─────────────────────────────────────┐
│ 사용 가능한 강의 목록 표시          │
│ (폴더명 기반, PDF+TXT 존재 여부)    │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 사용자에게 처리할 강의 선택 요청    │
│ (번호 또는 폴더명으로 선택)         │
└─────────────────────────────────────┘
```

**구현 사항**:
- `data:` 폴더 내 하위 폴더 스캔
- 각 폴더의 PDF/TXT 파일 존재 여부 확인
- PDF와 TXT가 모두 있는 폴더만 선택 가능하도록 표시
- 대화형 프롬프트로 사용자 입력 받기

### Step 2: 파일 감지 및 로드
```
┌─────────────────────────────────────┐
│ 선택된 폴더 내 파일 스캔            │
│ - PDF 파일 목록                     │
│ - TXT 파일 목록                     │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ PDF 처리                            │
│ - 각 페이지를 이미지로 변환         │
│ - 또는 텍스트 추출 (OCR 필요시)     │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ TXT 처리                            │
│ - 여러 파일 병합 (분할된 경우)      │
│ - 타임스탬프 기준 파싱              │
│ - 화자별 발화 구분                  │
└─────────────────────────────────────┘
```

**구현 사항**:
- PDF 라이브러리: `PyMuPDF(fitz)` 또는 `pdf2image`
- TXT 파싱: 정규표현식으로 화자/시간/내용 분리
- 분할된 TXT 파일 자동 병합 (파일명 정렬 기준)

### Step 3: 슬라이드-STT 매칭
```
┌─────────────────────────────────────┐
│ 매칭 전략 선택                      │
│                                     │
│ [방법 1] 시간 기반 균등 분할        │
│ - 전체 강의 시간 / 슬라이드 수      │
│ - 각 시간대의 STT를 해당 슬라이드에 │
│                                     │
│ [방법 2] 내용 유사도 기반           │
│ - PDF 텍스트 추출                   │
│ - STT 내용과 유사도 계산            │
│ - 가장 유사한 슬라이드에 매칭       │
│                                     │
│ [방법 3] LLM 기반 매칭              │
│ - PDF 내용 + STT를 LLM에 전달       │
│ - LLM이 매칭 결정                   │
└─────────────────────────────────────┘
```

**권장 방법**: 
- 1차: 시간 기반 균등 분할 (간단하고 빠름)
- 2차: LLM 기반 매칭 (정확도 향상)

**고려사항**:
- 슬라이드 전환 시점을 정확히 알 수 없음
- 일부 슬라이드는 빠르게, 일부는 오래 설명할 수 있음
- PDF에 텍스트가 없는 이미지 슬라이드 존재 가능

### Step 4: 핵심 내용 정리
```
┌─────────────────────────────────────┐
│ 각 슬라이드별 STT 내용을            │
│ LLM으로 요약                        │
│                                     │
│ - 불필요한 내용 제거 (잡담 등)      │
│ - 핵심 포인트 추출                  │
│ - 간결한 문장으로 정리              │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Q&A 섹션 추출                       │
│ - "질문", "답변" 패턴 감지          │
│ - 또는 화자 변경 패턴 감지          │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Key Takeaways 생성                  │
│ - 전체 내용 기반 핵심 요점 3-5개    │
└─────────────────────────────────────┘
```

**구현 사항**:
- LLM API 호출 (OpenAI, Claude 등)
- 프롬프트 엔지니어링으로 일관된 형식 유지
- 토큰 제한 고려한 청크 분할

### Step 5: 최종 마크다운 생성
```
┌─────────────────────────────────────┐
│ 마크다운 문서 생성                  │
│                                     │
│ # 강의 제목                         │
│ - 강연자: OOO                       │
│ - 날짜: YYYY.MM.DD                  │
│                                     │
│ ## 슬라이드 1                       │
│ [슬라이드 이미지 또는 링크]         │
│ ### 주요 내용                       │
│ - 내용 1                            │
│ - 내용 2                            │
│                                     │
│ ## 슬라이드 2                       │
│ ...                                 │
│                                     │
│ ## Q&A                              │
│ ...                                 │
│                                     │
│ ## Key Takeaways                    │
│ ...                                 │
└─────────────────────────────────────┘
```

**출력 옵션**:
- 마크다운 파일 (.md)
- HTML 변환 (선택적)
- PDF 변환 (선택적)

---

## 4. 기술 스택

### 필수 라이브러리
```
PyMuPDF (fitz)    # PDF 처리
Pillow            # 이미지 처리
openai            # LLM API (또는 anthropic)
python-dotenv     # 환경 변수 관리
```

### 선택적 라이브러리
```
pdf2image         # PDF를 이미지로 변환
pytesseract       # OCR (필요시)
markdown          # 마크다운 변환
weasyprint        # PDF 출력
```

---

## 5. 예외 처리

### 처리해야 할 케이스
| 케이스 | 처리 방법 |
|--------|-----------|
| TXT 파일 없음 | 경고 메시지 후 스킵 또는 PDF만으로 처리 |
| PDF 파일 없음 | 에러 메시지 후 해당 폴더 스킵 |
| 여러 PDF 파일 | 파일명의 순서 번호(1, 2)를 기준으로 자동 병합 |
| 분할된 TXT 파일 | 파일명 순서대로 자동 병합 |
| 빈 폴더 | 목록에서 제외 |
| STT 형식 오류 | 기본 파싱 시도 후 실패 시 원본 텍스트 사용 |

---

## 6. 프로젝트 파일 구조
```
SNU_ABC_Archive/
├── data:/                    # 원본 데이터
│   └── {강의별 폴더}/
├── docs/
│   └── plan.md              # 이 문서
├── output/                   # 생성된 결과물
│   └── {강의별 폴더}/
│       ├── notes.md
│       └── slides/          # 슬라이드 이미지
├── src/                      # 소스 코드
│   ├── main.py              # 메인 실행 파일
│   ├── pdf_processor.py     # PDF 처리 모듈
│   ├── stt_parser.py        # STT 파싱 모듈
│   ├── matcher.py           # 슬라이드-STT 매칭 모듈
│   ├── summarizer.py        # LLM 요약 모듈
│   └── generator.py         # 마크다운 생성 모듈
├── requirements.txt          # 의존성 목록
└── .env                      # API 키 등 환경 변수
```

---

## 7. 실행 흐름 요약

```
┌──────────────────┐
│   프로그램 시작   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  강의 목록 표시   │
│  사용자 선택      │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  PDF/TXT 로드    │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  슬라이드-STT    │
│     매칭         │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  LLM 요약 생성   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  마크다운 출력   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   프로그램 종료   │
└──────────────────┘
```

---

## 8. 향후 개선 사항

- [ ] 슬라이드 전환 시점 자동 감지 (음성 패턴 분석)
- [ ] 웹 UI 추가 (Streamlit 등)
- [ ] 배치 처리 (여러 강의 한 번에 처리)
- [ ] 다국어 지원
- [ ] 자동 키워드 추출 및 인덱싱
